<div id="cart_wrapper">
  {% if cart_products.count > 0 %}
  <h4>Cesta ({{ cart_products.count }})</h4>
  <div id="cart_list">
    {% for cp in cart_products %}
    <div id="cart_product" class="container-fluid row">
      <div class="col-4">
        <img class="cart_slider_img" src="{{cp.product.image.url}}" />
      </div>
      <div class="col-8">
        <span class="cart_slider_name cp_info">{{cp.product.name}}</span>
        <span class="cart_slider_price cp_info">{{cp.product.price}} €
          {% if cp.quantity > 1 %}<small> x {{cp.quantity}}</small>{% endif %}</span>
        <span class="cart_slider_size cp_info secondary">Talla: {{cp.size}}</span>
        <span class="cart_slider_quantity cp_info secondary">Cantidad: {{cp.quantity}}</span>
        <a id="delete_cart_product" href="#" name="{{cp.pk}}"><i class="fa fa-trash-o"></i></a>
      </div>
    </div>
    {% endfor %}
  </div>

  <div id="cart_total">
    <span id="total_price"><b>Total: <span class="result">{{total_price}} €</span></b></span>
    <br />
    <span id="total_shipment">Envío: <span class="result">Gratuito</span></span>
    <a href="{% url 'payment:personal' %}" class="btn btn-default" id="cart_comprar">Comprar</a>
  </div>

  {% else %}
  <h4>Tu bolsa está vacía</h4>
  {% endif %}
</div>

{% block head %}
<script>
  $("#delete_cart_product").click(function(event){
    event.preventDefault();
    var name = $(this).attr("name");
    var that = $(this);
    $.ajax({
      url: "/cart/delete/",
      type: "POST",
      data: {
        pk: name,
        csrfmiddlewaretoken: '{{ csrf_token }}'
      },
      success:function(data){
        that.closest("#cart_product").fadeOut();
        var price = that.closest(".cart_slider_price").val();
        var total_price = $("#total_price .result").val();
        var new_total = total_price - price;
        $("#total_price .result").text(new_total);
      }
    });
  });
</script>
{% endblock %}
